function ColorFinder(t){this.callback=t,this.getMostProminentColor=function(t){var a=null;this.callback||(this.callback=function(){return 1});var e=this.getImageData(t);return a=this.getMostProminentRGBImpl(e,6,a,this.callback),a=this.getMostProminentRGBImpl(e,4,a,this.callback),a=this.getMostProminentRGBImpl(e,2,a,this.callback),a=this.getMostProminentRGBImpl(e,0,a,this.callback)},this.getImageData=function(t,a){var e,i,n,r,o,h,l=document.createElement("canvas"),g=l.getContext&&l.getContext("2d"),c=-4;if(!g)return defaultRGB;r=l.height=t.naturalHeight||t.offsetHeight||t.height,n=l.width=t.naturalWidth||t.offsetWidth||t.width,g.drawImage(t,0,0);try{i=g.getImageData(0,0,n,r)}catch(s){return null}h=i.data.length;for(var d=Math.max(1,Math.round(h/5e3)),u={};(c+=4*d)<h;)i.data[c+3]>32&&(o=(i.data[c]>>a)+","+(i.data[c+1]>>a)+","+(i.data[c+2]>>a),u.hasOwnProperty(o)?(e=u[o],e.count++):(e={r:i.data[c],g:i.data[c+1],b:i.data[c+2],count:1},e.weight=this.callback(e.r,e.g,e.b),e.weight<=0&&(e.weight=1e-10),u[o]=e));return u},this.getMostProminentRGBImpl=function(t,a,e){var n,r,o,h,l,g,c={r:0,g:0,b:0,count:0,d:a},s={},d=0;for(r in t)n=t[r],totalWeight=n.weight*n.count,++d,this.doesRgbMatch(e,n.r,n.g,n.b)&&(o=(n.r>>a)+","+(n.g>>a)+","+(n.b>>a),s.hasOwnProperty(o)?s[o]+=totalWeight:s[o]=totalWeight);for(i in s)data=i.split(","),h=data[0],l=data[1],g=data[2],d=s[i],d>c.count&&(c.count=d,data=i.split(","),c.r=h,c.g=l,c.b=g);return c},this.doesRgbMatch=function(t,a,e,i){return null==t?!0:(a>>=t.d,e>>=t.d,i>>=t.d,t.r==a&&t.g==e&&t.b==i)}}